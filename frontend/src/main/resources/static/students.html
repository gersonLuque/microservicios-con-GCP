<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Management</title>
</head>
<body>
    <h1>Student Management</h1>

    <h2>All Students</h2>
    <table id="studentsTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Email</th>
          <th>Numero de curso</th>
        </tr>
      </thead>
      <tbody id="studentsBody">
      </tbody>
    </table>

    <h1>List Files</h1>
    <button id="listFilesButton">List Files</button>
    <ul id="fileList"></ul>



    <h1>Upload File</h1>
    <form id="uploadForm">
        <input type="file" id="fileInput" name="file">
        <button type="button" onclick="uploadFile()">Upload</button>
    </form>
    <div id="message"></div>

    <h2>Download File</h2>
    <form id="downloadForm">
        <label for="fileName">Enter File Name:</label>
        <input type="text" id="fileName" name="fileName" />
        <button type="submit">Download</button>
    </form>
    <div id="downloadLink" class="download-link" style="display: none"></div>

    <script>
      const baseUrl = "http://localhost:8080/api/student";

      async function fetchStudents() {
        try {
          const response = await fetch(`${baseUrl}/all`);
          console.log(response);
          const students = await response.json();
          displayStudents(students);
        } catch (error) {
          console.error("Error fetching students:", error);
        }
      }

      function displayStudents(students) {
        const studentsBody = document.getElementById("studentsBody");
        studentsBody.innerHTML = "";
        students.forEach((student) => {
          const row = `<tr>
                        <td>${student.id}</td>
                        <td>${student.name}</td>
                        <td>${student.lastName}</td>
                        <td>${student.email}</td>
                        <td>${student.courseId}</td>
                      </tr>`;
          studentsBody.innerHTML += row;
        });
      }

      document.getElementById("downloadForm").addEventListener("submit", function (event) {
        event.preventDefault();
        const fileName = document.getElementById("fileName").value.trim();
        if (!fileName) {
          alert("Please enter a file name.");
          return;
        }

        const downloadUrl = `${baseUrl}/file/${fileName}`;
        window.location.href = downloadUrl;
      });

      fetchStudents();

      async function uploadFile() {

            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];

            console.log(file);

            if (!file) {
                alert("Please select a file.");
                return;
            }

            const formData = new FormData();
            formData.append("file", file);

            try {
                const response = await fetch('http://localhost:8080/api/student/upload', {
                    method: 'POST',
                    body: formData
                });
                console.log(response);

                const message = document.getElementById('message');

                if (response.ok) {
                    const result = await response.text();
                    message.innerText = "File uploaded successfully: " + result;
                } else {
                    message.innerText = "Failed to upload file: " + response.statusText;
                }

            } catch (error) {
                console.error("Error uploading file:", error);
                const message = document.getElementById('message');
                message.innerText = "Error uploading file: " + error;
            }
        }
        document.getElementById('listFilesButton').addEventListener('click', async () => {
            try {
                const response = await fetch('http://localhost:8080/api/student/files');
                if (response.ok) {
                    const fileNames = await response.json();
                    const fileList = document.getElementById('fileList');
                    fileList.innerHTML = '';
                    fileNames.forEach(fileName => {
                        const listItem = document.createElement('li');
                        listItem.textContent = fileName;
                        fileList.appendChild(listItem);
                    });
                } else {
                    alert('Failed to list files');
                }
            } catch (error) {
                console.error('Error fetching file list:', error);
                alert('Error fetching file list');
            }
        })
    </script>
</body>
</html>
