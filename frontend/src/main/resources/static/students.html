<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Management</title>
</head>
<body>
    <h1>Student Management</h1>

    <h2>All Students</h2>
    <table id="studentsTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Email</th>
          <th>Numero de curso</th>
        </tr>
      </thead>
      <tbody id="studentsBody">
      </tbody>
    </table>

    <h2>Download File</h2>
    <form id="downloadForm">
        <label for="fileName">Enter File Name:</label>
        <input type="text" id="fileName" name="fileName" />
        <button type="submit">Download</button>
    </form>
    <div id="downloadLink" class="download-link" style="display: none"></div>

    <script>
      const baseUrl = "http://localhost:8080/api/student";

      async function fetchStudents() {
        try {
          const response = await fetch(`${baseUrl}/all`);
          console.log(response);
          const students = await response.json();
          displayStudents(students);
        } catch (error) {
          console.error("Error fetching students:", error);
        }
      }

      function displayStudents(students) {
        const studentsBody = document.getElementById("studentsBody");
        studentsBody.innerHTML = "";
        students.forEach((student) => {
          const row = `<tr>
                        <td>${student.id}</td>
                        <td>${student.name}</td>
                        <td>${student.lastName}</td>
                        <td>${student.email}</td>
                        <td>${student.courseId}</td>
                      </tr>`;
          studentsBody.innerHTML += row;
        });
      }

      document.getElementById("downloadForm").addEventListener("submit", function (event) {
        event.preventDefault();
        const fileName = document.getElementById("fileName").value.trim();
        if (!fileName) {
          alert("Please enter a file name.");
          return;
        }

        const downloadUrl = `${baseUrl}/file/${fileName}`;
        window.location.href = downloadUrl;
      });

      fetchStudents();
    </script>
</body>
</html>
